<html>
  <head>
    <link href="reset.css" rel="stylesheet" type="text/css">
    <link href="base.css" rel="stylesheet" type="text/css">
    <title>
      D3, Conceptually - Lesson 1
    </title>
    <script type="text/javascript" src="d3.v2.min.js"></script>
    <script type="text/javascript" src="base.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24357809-1']);
      _gaq.push(['_setDomainName', 'hazzens.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <div class='header'>
      <div class='left-bar'>
      </div>
      <div class='content'>
        <h1 id='masthead'>
          D3, Conceptually
        </h1>
        <h2 class='lesson'>
          Lesson 1: Introductory Elements
        </h2>
      </div>
    </div>
    <div class='main'>
      <div class='left-bar'>
        <h2 class='border-bottom'>index</h2>
        <ul class='pad-top selector'>
          <li><a href='#'>1. Intro</a></li>
          <li>
          <ul class='selector'>
            <li><a href='#s1'>1.1</a>
            <li><a href='#s2'>1.2</a>
          </ul>
          </li>
        </ul>
      </div>
      <div class='content'>
        <div class='section'>
          <div class='section-header' id='s1'>
            1.1 Beginnings
          </div>
          <div class='section-content'>
            A simple example of basic d3 syntax is as good a starting point as
            any:
            <div class='sample'>
              <div class='code code-html'>&lt;div class='section'&gt;
  First
&lt;/div&gt;
&lt;div class='section'&gt;
  Second
&lt;/div&gt;</div>
              <div class ='code code-js'>d3.select('.section')
    .text('D3 was here');</div>
              <div class='code code-result'></div>
            </div>
            This code can be broken down into two parts:
            <ol>
              <li>a selection, <div class='code code-inline code-js'>d3.select('.section')</div>.
                  This takes a <a href='http://www.w3.org/TR/selectors-api/'>selector</a>
                  and returns a <div class='code code-inline code-js'>d3.selection</div>.
              <li>an operation, <div class='code code-inline code-js'>text('D3 was here')</div>.
                  The <div class='code code-inline code-js'>d3.selection</div>
                  returned by the previous call supports a number of these. The one
                  we called sets the <div class='code code-inline code-js'>textContent</div>
                of the selection to the argument.
            </ol>
            For convenience, d3 is nice and returns the selection itself from
            the operation. So, instead of writing this code:
            <div class='code code-js'>var section = d3.select('.section');
section.text('D3 was here');
section.style('color', '#f0f');  // Magenta to make sure pedestrians see my graffiti!</div>
             d3 lets you write it all in one statement:
            <div class='code code-js'>d3.select('.section')
    .text('D3 was here');
    .style('color', '#f0f');  // Magenta to make sure pedestrians see my graffiti!</div>
          </div>
        </div>
        <div class='section'>
          <div class='section-header' id='s2'>
            1.2 One node? I've got an army!
          </div>
          <div class='section-content'>
            So, you now have the tools to vandalize websites everywhere with
            magenta text letting people know how cool you are. But it would be
            pretty tedious to do so, one node at a time. Plus, as you saw from
            the first demo, the selection from <div class='code code-inline code-js'>d3.select</div>
            only got us the first matching node. Luckily, we have just the tool:
            <div class='sample'>
              <div class='code code-html'>&lt;div class='section'&gt;
  First
&lt;/div&gt;
&lt;div class='section'&gt;
  Second
&lt;/div&gt;</div>
              <div class ='code code-js'>d3.<em>selectAll</em>('.section')
    .text('D3 was here');</div>
              <div class='code code-result'></div>
            </div>
            Now, no <div class='code code-inline code-html'>div</div> is safe
            from your marker.
          </div>
        </div>
        <div class='section'>
          <div class='section-header' id='s3'>
            1.3 Happy little snowflakes
          </div>
          <div class='section-content'>
            You now have the tools to modify either the first node matching a
            selection, or all the nodes matching a selection. Sometimes, though,
            it would be nice to modify each node based on some property. Maybe
            you want the even ones to say 'Even' and the odd ones to say 'Odd'.
            D3, in its infinite wisdom, makes that easy:
            <div class='sample'>
              <div class='code code-html'>&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;
&lt;div&gt;&lt;/div&gt;</div>
              <div class ='code code-js'>d3.selectAll('div')
    .text(function() {
      var index = Array.prototype.indexOf.call(this.parentElement.children, this);
      return (index % 2) == 0 ? 'Even' : 'Odd';
    });</div>
              <div class='code code-result'></div>
            </div>
            Something of note - D3 defines <div class='code code-js code-inline'>this</div>
            inside the function as "the node the attribute will be set on".
          </div>
        </div>
        <div class='section'>
          <div class='section-header' id='s4'>
            1.4 Playing God
          </div>
          <div class='section-content'>
            All of this modification would be useless if not for the other side
            of the coin - creation! D3 provides an <div class='code code-js code-inline'>
            append</div> method on selections for this purpose. It takes a single
            argument - the tag name of the element to create. This can be any
            valid tag, like <div class='code code-html code-inline'>div</div>
            or <div class='code code-html code-inline'>table</div>. Like most
            <div class='code code-js code-inline'>d3.selection</div> methods, the
            return value is also a <div class='code code-js code-inline'>d3.selection</div>.
            However, it contains the newly-created nodes, and not the original
            selection:
            <div class='sample'>
              <div class='code code-html'>&lt;div class='things'&gt;
  &lt;div&gt;Sugar&lt;/div&gt;
&lt;/div&gt;</div>
              <div class ='code code-js'>d3.select('.things')
  .append('div')
    .style('color', 'red')
    .text('Spice');</div>
              <div class='code code-result'></div>
            </div>
            Like all selection methods, <div class='code code-js code-inline'>append</div>
            operates on all selected nodes. If multiple nodes are selected,
            multiple nodes will be created (and returned):
            <div class='sample'>
              <div class='code code-html'>&lt;div class='things'&gt;
  &lt;div&gt;Sugar&lt;/div&gt;
  &lt;div&gt;Spice&lt;/div&gt;
&lt;/div&gt;</div>
              <div class ='code code-js'>d3.selectAll('.things div')
  .append('div')
    .style('display', 'inline-block')
    .style('color', 'green')
    .text('\u2713');</div>
              <div class='code code-result'></div>
            </div>
            If you've played around with <a href='http://jquery.com/'>jQuery</a>,
            or other JavaScript libraries, you may notice similarities. The
            select/modify idiom in D3 is a very simple abstraction that proves
            shockingly effective at getting things
            done.
            <div class='aside'>
              The adventurous or deranged reader might see D3 as a lightweight
              alternative to <a href='http://jquery.com/'>jQuery</a> or even a
              JavaScript templating engine like <a href='https://github.com/janl/mustache.js/'>mustache.js</a>
              or <a href='https://developers.google.com/closure/templates/'>Google Closure Templates</a>.
              Yes, you could do it. If you examine the source of this page, you
              might even notice it being done. But don't say I told you to.
            </div>
          </div>
        </div>
        <div class='section'>
          <div class='section-header' id='s5'>
            1.5 But where's the data?
          </div>
          <div class='section-content'>
            You, the reader, might be confused at this point. You might have read,
            on the <a href='http://d3js.org/'>D3</a> website, "D3.js is a
            JavaScript library for manipulating documents based on data." But
            we haven't seen a single mention of data yet. Meet our new friend,
            the <div class='code code-js code-inline'>data</div> operator (a
            card-carrying member of the <div class='code code-js code-inline'>d3.selection</div>
            club). It binds some <div class='code code-js code-inline'>data</div>
            to a <div class='code code-js code-inline'>selection</div>.
            <div class='sample'>
              <div class='code code-html'>&lt;div class='slayer'&gt;&lt;/div&gt;
&lt;div class='slayer'&gt;&lt;/div&gt;
&lt;div class='slayer'&gt;&lt;/div&gt;</div>
              <div class='code code-js'>var slayerNames = [
  'Buffy',
  'Kendra',
  'Faith'
];
d3.selectAll('.slayer').data(slayerNames);</div>
              <div class='code code-result'></div>
            </div>
            The argument to <div class='code code-js code-inline'>data</div> is
            an <div class='code code-js code-inline'>Array</div>, the elements of
            which can have any type. By itself, binding data to elements doesn't
            accomplish anything without the ability to access it. You can get this
            <div class='code code-js code-inline'>Array</div> back out by calling
            the method with no arguments:
            <div class='code code-js'>var slayerNames = d3.selectAll('.slayers').data();</div>
            Still, though, that isn't much help. Without an easy way of getting
            data associated with a node and modifying the node in some way, one
            might as well not use D3. Going back to the <a href='#s3'>snowflakes</a>
            example, we saw a function passed as an argument to a
            <div class='code code-js code-inline'>d3.selection</div> method. What
            I didn't mention is that function is called with several arguments -
            the bound <div class='code code-js code-inline'>datum</div>
            of the current element, and its index within the
            <div class='code code-js code-inline'>selection</div>. By convention,
            we call these <div class='code code-js code-inline'>d</div> and
            <div class='code code-js code-inline'>i</div>. For example:
            <div class='sample'>
              <div class='code code-html'>&lt;div class='slayer'&gt;&lt;/div&gt;
&lt;div class='slayer'&gt;&lt;/div&gt;
&lt;div class='slayer'&gt;&lt;/div&gt;</div>
              <div class='code code-js'>var slayerNames = [
  'Buffy',
  'Kendra',
  'Faith'
];
d3.selectAll('.slayer').data(slayerNames)
    .text(function(d, i) {
      return 'Slayer #' + (i + 1) + ': ' + d;  // i is 0-based.
    });</div>
              <div class='code code-result'></div>
            </div>
            It turns out most methods of selection that set some property
            of each node in the selection support this idiom: arguments
            can either be functions (called with
            <div class='code code-js code-inline'>datum</div> and
            <div class='code code-js code-inline'>index</div>, and a
            <div class='code code-js code-inline'>this</div> of the node), or
            a literal value. They both come in handy - sometimes, you want every
            node to have a <div class='code code-html code-inline'>font-style</div>
            of <div class='code code-html code-inline'>bold</div>, and sometimes
            you want each node to get special treatment.
            <hr>
            And what if the length of data doesn't match the length of the
            selection? To our neophyte eyes, not much. The selection is only
            as many nodes as existent, and the remaineder of the data (if any)
            is simply ignored.
            <div class='sample'>
              <div class='code code-html'>&lt;div class='captain'&gt;&lt;/div&gt;
&lt;div class='captain'&gt;&lt;/div&gt;</div>
              <div class='code code-js'>var captainNames = [
  'Kirk',
  'Picard',
  'Sisko',
  'Janeway',
  'Archer'
];
d3.selectAll('.captain').data(captainNames)
    .text(function(d, i) {
      return 'Captain #' + (i + 1) + ': ' + d;  // i is 0-based.
    });</div>
              <div class='code code-result'></div>
            </div>
            <div class='aside'>
              Everything is more complex than this, but we'll get to that
              when the time comes. Starting right now, actually.
            </div>
          </div>
        </div>
        <div class='section'>
          <div class='section-header' id='s6'>
            1.6 Two nodes enter, no nodes leave
          </div>
          <div class='section-content'>
            The <div class='code code-js code-inline'>data</div> method, mentioned
            previously, doesn't just bind data to elements. It computes a data
            <em>join</em> between the nodes in the document and the data provided.
            If two elements are selected and five datum provided, D3 notes three
            more datum were provided than elements and stores this in the
            <div class='code code-js code-inline'>enter</div> selection, accessible
            via the <div class='code code-js code-inline'>enter</div> method
            on the return value of a call to <div class='code code-js code-inline'>data</div>.
            As there are no actual nodes to select, <div class='code code-js code-inline'>enter</div>
            doesn't support most <div class='code code-js code-inline'>d3.selection</div>
            methods. It does, however, allow <div class='code code-js code-inline'>append</div>:
            <div class='sample'>
              <div class='code code-html'>&lt;div class='captains'&gt;
  &lt;div class='captain'&gt;&lt;/div&gt;
  &lt;div class='captain'&gt;&lt;/div&gt;
&lt;/div&gt;</div>
              <div class='code code-js'>var captainNames = [
  'Kirk',
  'Picard',
  'Sisko',
  'Janeway',
  'Archer'
];
var parent = d3.select('.captains');
var captains = parent.selectAll('.captain').data(captainNames);
captains.enter().append('div')
    .style('color', 'green')
    .attr('class', 'captain')  // attr is like style or text, but sets node-level attributes.
    .text(function(d, i) {
      return 'Captain #' + (i + 1) + ': ' + d;
  });
captains
    .text(function(d, i) {
      return 'Captain #' + (i + 1) + ': ' + d;
    });</div>
              <div class='code code-result'></div>
            </div>
            All captains in a line, now. Calling <div class='code code-js code-inline'>append</div>
            operated on the parent of our selection, appending one node
            per additional data element - in this case creating three new divs
            as the last children of <div class='code code-html code-inline'>div class='captains'</div>.
            <hr>
            The <div class='code code-js code-inline'>enter</div> selection also
            has another trick up its sleeve - nodes appended with it are automatically
            inserted in the proper place in the <em>original</em> selection. So,
            the following code still is equivalent to, and less error-prone than,
            the example:
            <div class='code code-js'>...
captains.enter().append('div')
    .style('color', 'green')
    .attr('class', 'captain');
// captains now has the newly-appended nodes in its selection,
// so those nodes will be included in all method calls.
captains
    .text(function(d, i) {
      return 'Captain #' + (i + 1) + ': ' + d;
    });</div>
            If the <div class='code code-js code-inline'>text</div> call was before
            the <div class='code code-js code-inline'>append</div>, only the
            existing nodes would get text. As such, it is usually best to deal
            with the <div class='code code-js code-inline'>enter</div> selection first.
            You don't even need any nodes to begin with; you can have an <em>empty</em>
            selection and append to it, as long as it has a valid parent:
            <div class='sample'>
              <div class='code code-html'>&lt;div class='lucky-numbers'&gt;&lt;/div&gt;</div>
              <div class='code code-js'>var parent = d3.select('.lucky-numbers');
// We are selecting all of the .number nodes - which don't exist!
var numbers = parent.selectAll('.number').data([7, 8, 21, 888]);
numbers.enter().append('div')
    .text(function(d, i) { return d; });</div>
              <div class='code code-result'></div>
            </div>
            While the above code works, it is actually missing one crucial detail.
            When appending elements to a selection, it is good practice to ensure
            the new elements would match the selection. This isn't enforced, but
            not doing so leads to an unhappy coder. So the correct, ever-shorter,
            version of the code would be:
            <div class='code code-js'>d3.select('.lucky-numbers').selectAll('.number')
    .data([7, 8, 21, 888])
  .enter().append('div')
    <em>.attr('class', 'number')</em>
    .text(function(d, i) { return d; });</div>
            <div class='aside'>
              There are many different coding styles to use when writing D3. This
              comes down to personal taste, but the example set by the D3 documentation
              is not a bad one:
              <ul class='bullet-list'>
                <li>Multiple <div class='code code-js code-inline'>select</div>
                operations can be on one line</li>
                <li>Modifying operations on a selection are indented four spaces
                and get their own line</li>
                <li>Pair <div class='code code-js code-inline'>enter</div> and
                <div class='code code-js code-inline'>append</div> together on
                one line with a two-space indent<br>This makes it obvious
                operations are on a new set of nodes, not the original selection</li>
                <li>Only have one <div class='code code-js code-inline'>selectAll</div>
                per statement</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class='footer'>
    </div>
  </body>
  <script type="text/javascript">
    tut.init();
  </script>
</html>
